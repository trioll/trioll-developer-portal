# Authentication Fix Documentation - September 5, 2025

## UPDATE 2: Fixed Client ID Configuration (22:10 GMT)

### Second Issue Discovered
Even after synchronizing client IDs, authentication was still failing because:
- The backend Lambda expects the **mobile app client ID**: `bft50gui77sdq2n4lcio4onql`
- The developer portal was using its own client ID: `5joogquqr4jgukp7mncgp3g23h`

### Solution Applied
Updated both auth-service.js and index.html to use the mobile app client ID that the backend expects:
```javascript
// Both files now use:
this.clientId = 'bft50gui77sdq2n4lcio4onql'; // Mobile app client ID
```

This is necessary because the backend Lambda is shared between the mobile app and developer portal, and it's hardcoded to expect the mobile app's client ID.

---

# Original Authentication Fix Documentation - September 5, 2025

## Problem Discovered
The developer portal was using **mismatched Cognito client IDs** across different components:

### Client ID Mismatch
1. **auth-service.js**: Uses client ID `5joogquqr4jgukp7mncgp3g23h` (Developer Portal)
2. **index.html**: Was using client ID `7oe9p2vqckcj64p83c5v3p26o4` (Unknown/Invalid)
3. **Backend Lambda**: Uses client ID `bft50gui77sdq2n4lcio4onql` (Mobile App)

All three components share the same User Pool: `us-east-1_cLPH2acQd`

## Root Cause
When auth-service.js logs you in:
1. It gets tokens from Cognito using client ID `5joogquqr4jgukp7mncgp3g23h`
2. It stores these tokens in localStorage/sessionStorage
3. index.html retrieves the tokens but tries to validate them with a different client ID
4. The validation fails because tokens from one client ID cannot be used with another client ID
5. Result: "No token found" errors despite being logged in

## Fix Applied
Updated index.html line 2020 to use the same client ID as auth-service.js:
```javascript
// FIXED: Synchronized with auth-service.js client ID
const portalClientId = '5joogquqr4jgukp7mncgp3g23h';
```

## Why This Works
- Both auth-service.js and index.html now use the same Cognito client ID
- Tokens generated by auth-service.js are now valid when used by index.html
- AWS SDK can now properly exchange tokens for temporary credentials
- S3 uploads should work correctly

## Backend Considerations

### Current Architecture
1. **User Pool**: `us-east-1_cLPH2acQd` (shared between Mobile App and Developer Portal)
2. **Mobile App Client**: `bft50gui77sdq2n4lcio4onql`
3. **Developer Portal Client**: `5joogquqr4jgukp7mncgp3g23h`
4. **Identity Pool**: `us-east-1:c740f334-5bd2-43c6-85b9-48bfebf27268`

### Important Notes
- The backend Lambda functions default to the mobile app client ID
- This shouldn't affect the developer portal as long as tokens are properly validated
- Both clients belong to the same user pool, so users are shared

## Testing Checklist
- [ ] Login works correctly
- [ ] Tokens are stored in localStorage/sessionStorage
- [ ] Profile loads after login
- [ ] S3 uploads work
- [ ] Game metadata saves to database
- [ ] All API calls succeed

## Future Recommendations
1. **Environment Variables**: Configure client IDs via environment variables
2. **Separate Identity Pools**: Consider separate pools for mobile vs web (already in backlog)
3. **Consistent Configuration**: Ensure all components use the same client ID
4. **Documentation**: Keep this authentication architecture documented

## Related Files
- `/auth-service.js` - Authentication service (uses developer portal client)
- `/index.html` - Main portal (now uses developer portal client)
- `/backend-updates/unified-developers-api.js` - Backend Lambda (uses mobile app client)