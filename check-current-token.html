<!DOCTYPE html>
<html>
<head>
    <title>Check Current Token</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        pre {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            overflow: auto;
        }
        .highlight {
            color: #10b981;
            font-weight: bold;
        }
        .missing {
            color: #ef4444;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Current Token Analysis</h1>
    <div id="output"></div>
    
    <script>
        function checkToken() {
            const token = sessionStorage.getItem('developerToken') || 
                         localStorage.getItem('developerToken');
            
            if (!token) {
                document.getElementById('output').innerHTML = '<p>No token found!</p>';
                return;
            }
            
            try {
                const parts = token.split('.');
                const payload = JSON.parse(atob(parts[1]));
                
                let html = '<h2>Token Payload:</h2><pre>' + JSON.stringify(payload, null, 2) + '</pre>';
                
                html += '<h2>Developer Attributes Check:</h2><ul>';
                
                // Check standard attributes we're using
                if (payload.preferred_username) {
                    html += `<li class="highlight">✅ preferred_username (developer_id): ${payload.preferred_username}</li>`;
                } else {
                    html += '<li class="missing">❌ preferred_username: NOT FOUND</li>';
                }
                
                if (payload.website) {
                    html += `<li class="highlight">✅ website (company_name): ${payload.website}</li>`;
                } else {
                    html += '<li class="missing">❌ website: NOT FOUND</li>';
                }
                
                if (payload.profile) {
                    html += `<li class="highlight">✅ profile (user_type): ${payload.profile}</li>`;
                } else {
                    html += '<li class="missing">❌ profile: NOT FOUND</li>';
                }
                
                html += '</ul>';
                
                // Check if token needs refresh
                const exp = payload.exp;
                const now = Math.floor(Date.now() / 1000);
                const timeLeft = exp - now;
                
                html += '<h2>Token Status:</h2><ul>';
                html += `<li>Expires in: ${Math.floor(timeLeft / 60)} minutes</li>`;
                html += `<li>User ID: ${payload.sub}</li>`;
                html += `<li>Email: ${payload.email}</li>`;
                html += '</ul>';
                
                if (!payload.preferred_username && !payload.website && !payload.profile) {
                    html += '<h2 style="color: #f59e0b;">⚠️ Token Missing Developer Attributes!</h2>';
                    html += '<p>You need to logout and login again to get a new token with the attributes.</p>';
                    html += '<button onclick="clearAndReload()">Clear Session & Reload</button>';
                }
                
                document.getElementById('output').innerHTML = html;
                
            } catch (e) {
                document.getElementById('output').innerHTML = `<p>Error decoding token: ${e.message}</p>`;
            }
        }
        
        function clearAndReload() {
            sessionStorage.clear();
            localStorage.clear();
            window.location.href = 'https://triolldev.com';
        }
        
        // Run on page load
        checkToken();
    </script>
</body>
</html>