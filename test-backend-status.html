<!DOCTYPE html>
<html>
<head>
    <title>Backend Status Test</title>
    <style>
        body { 
            font-family: Arial; 
            padding: 20px; 
            background: #1a1a1a; 
            color: #fff;
            max-width: 800px;
            margin: 0 auto;
        }
        .test { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid #333;
            border-radius: 5px;
            background: #2a2a2a;
        }
        .success { background: #1a3a1a; border-color: #4ade80; }
        .error { background: #3a1a1a; border-color: #ef4444; }
        button { 
            padding: 10px 20px; 
            margin: 5px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        pre { 
            background: #000; 
            padding: 10px; 
            overflow-x: auto;
            border-radius: 3px;
        }
        .warning {
            background: #3a3a1a;
            border-color: #fbbf24;
            padding: 15px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>üîß Backend Status Test</h1>
    
    <div class="warning">
        <strong>‚ö†Ô∏è Important:</strong> This tests the actual backend endpoints. 
        Make sure you're logged in at triolldev.com first to have a valid token.
    </div>

    <div class="test">
        <h3>1. Test Login Endpoint</h3>
        <p>Tests if /developers/login is working</p>
        <button onclick="testLogin()">Test Login</button>
        <pre id="login-result"></pre>
    </div>

    <div class="test">
        <h3>2. Test Profile Endpoint</h3>
        <p>Tests if /developers/profile is working (requires token)</p>
        <button onclick="testProfile()">Test Profile</button>
        <pre id="profile-result"></pre>
    </div>

    <div class="test">
        <h3>3. Check Games API</h3>
        <p>Tests if games endpoints are working</p>
        <button onclick="testGames()">Test Games API</button>
        <pre id="games-result"></pre>
    </div>

    <script>
        const API_BASE = 'https://4ib0hvu1xj.execute-api.us-east-1.amazonaws.com/prod';
        
        async function testLogin() {
            const resultEl = document.getElementById('login-result');
            resultEl.textContent = 'Testing...';
            
            try {
                // Test with invalid credentials to see if endpoint exists
                const response = await fetch(`${API_BASE}/developers/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: 'test@test.com',
                        password: 'test123'
                    })
                });
                
                const data = await response.text();
                
                resultEl.textContent = JSON.stringify({
                    status: response.status,
                    statusText: response.statusText,
                    headers: {
                        'content-type': response.headers.get('content-type'),
                        'x-amzn-requestid': response.headers.get('x-amzn-requestid')
                    },
                    response: data
                }, null, 2);
                
                resultEl.parentElement.className = response.status === 401 ? 'test success' : 'test error';
                
            } catch (error) {
                resultEl.textContent = `Network Error: ${error.message}`;
                resultEl.parentElement.className = 'test error';
            }
        }
        
        async function testProfile() {
            const resultEl = document.getElementById('profile-result');
            resultEl.textContent = 'Testing...';
            
            const token = localStorage.getItem('developerToken') || sessionStorage.getItem('developerToken');
            
            if (!token) {
                resultEl.textContent = 'No token found. Please login at triolldev.com first.';
                resultEl.parentElement.className = 'test error';
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/developers/profile`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const data = await response.text();
                
                resultEl.textContent = JSON.stringify({
                    status: response.status,
                    statusText: response.statusText,
                    headers: {
                        'content-type': response.headers.get('content-type'),
                        'x-amzn-errortype': response.headers.get('x-amzn-errortype')
                    },
                    response: data
                }, null, 2);
                
                resultEl.parentElement.className = response.ok ? 'test success' : 'test error';
                
                // Try to parse error details
                if (!response.ok) {
                    try {
                        const errorData = JSON.parse(data);
                        if (errorData.message) {
                            resultEl.textContent += '\n\nError details: ' + errorData.message;
                        }
                    } catch (e) {}
                }
                
            } catch (error) {
                resultEl.textContent = `Network Error: ${error.message}`;
                resultEl.parentElement.className = 'test error';
            }
        }
        
        async function testGames() {
            const resultEl = document.getElementById('games-result');
            resultEl.textContent = 'Testing...';
            
            try {
                const response = await fetch(`${API_BASE}/games`);
                const data = await response.text();
                
                let parsedData;
                try {
                    parsedData = JSON.parse(data);
                    // Only show first 3 games to keep output readable
                    if (parsedData.games && parsedData.games.length > 3) {
                        parsedData.games = parsedData.games.slice(0, 3);
                        parsedData.truncated = true;
                        parsedData.totalGames = JSON.parse(data).games.length;
                    }
                } catch (e) {
                    parsedData = data;
                }
                
                resultEl.textContent = JSON.stringify({
                    status: response.status,
                    statusText: response.statusText,
                    response: parsedData
                }, null, 2);
                
                resultEl.parentElement.className = response.ok ? 'test success' : 'test error';
                
            } catch (error) {
                resultEl.textContent = `Network Error: ${error.message}`;
                resultEl.parentElement.className = 'test error';
            }
        }
    </script>
</body>
</html>