<!DOCTYPE html>
<html>
<head>
    <title>Test Identity Pool Authentication</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a1a; color: #fff; }
        button { padding: 10px 20px; margin: 10px 0; cursor: pointer; }
        .log { background: #000; padding: 10px; border-radius: 5px; margin: 10px 0; font-family: monospace; }
        .success { color: #4ade80; }
        .error { color: #ef4444; }
    </style>
</head>
<body>
    <h1>Test Identity Pool Authentication</h1>
    <button onclick="testAuth()">Test Developer Portal Authentication</button>
    <div id="log"></div>
    
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1099.0.min.js"></script>
    <script>
        function log(msg, type = '') {
            const logEl = document.getElementById('log');
            const div = document.createElement('div');
            div.className = 'log ' + type;
            div.textContent = new Date().toISOString() + ' - ' + msg;
            logEl.appendChild(div);
        }
        
        async function testAuth() {
            log('Starting authentication test...');
            
            // Get token from storage
            const token = localStorage.getItem('developerToken') || sessionStorage.getItem('developerToken');
            
            if (!token) {
                log('No developer token found. Please login to the developer portal first.', 'error');
                return;
            }
            
            log('Token found, configuring AWS...');
            
            AWS.config.region = 'us-east-1';
            AWS.config.credentials = new AWS.CognitoIdentityCredentials({
                IdentityPoolId: 'us-east-1:c740f334-5bd2-43c6-85b9-48bfebf27268',
                Logins: {
                    'cognito-idp.us-east-1.amazonaws.com/us-east-1_cLPH2acQd': token
                }
            });
            
            log('Refreshing credentials...');
            
            AWS.config.credentials.refresh((error) => {
                if (error) {
                    log('Error: ' + error.message, 'error');
                    log('Error code: ' + error.code, 'error');
                } else {
                    log('Success! Identity ID: ' + AWS.config.credentials.identityId, 'success');
                    log('Access Key: ' + AWS.config.credentials.accessKeyId.substring(0, 10) + '...', 'success');
                    
                    // Try to list S3 buckets as a test
                    const s3 = new AWS.S3();
                    s3.listBuckets((err, data) => {
                        if (err) {
                            log('S3 test failed: ' + err.message, 'error');
                        } else {
                            log('S3 test successful! Found ' + data.Buckets.length + ' buckets', 'success');
                        }
                    });
                }
            });
        }
    </script>
</body>
</html>
