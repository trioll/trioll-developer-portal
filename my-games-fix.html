<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Games Debug & Fix</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .section {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .warning { color: #f59e0b; }
        .info { color: #3b82f6; }
        pre {
            background: #000;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #2563eb; }
        .game-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        th {
            background: rgba(255, 255, 255, 0.1);
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ® My Games Debug Tool</h1>
        <p>This tool helps identify why games aren't showing in your "My Games" tab.</p>
        
        <div class="section">
            <h2>Your Developer Info</h2>
            <div id="devInfo"></div>
        </div>
        
        <div class="section">
            <h2>All Games Analysis</h2>
            <button onclick="analyzeGames()">Analyze All Games</button>
            <div id="gamesAnalysis"></div>
        </div>
        
        <div class="section">
            <h2>Historical Games Without Developer ID</h2>
            <p class="warning">These games won't appear in "My Games" because they lack developerId:</p>
            <div id="historicalGames"></div>
            <button onclick="claimHistoricalGames()" style="background: #f59e0b;">Claim These Games</button>
        </div>
        
        <div class="section">
            <h2>Quick Fix for Portal</h2>
            <p>This JavaScript snippet will make "My Games" show all games temporarily:</p>
            <pre id="quickFix"></pre>
            <button onclick="copyQuickFix()">Copy Fix to Clipboard</button>
        </div>
    </div>
    
    <script>
        const AWS_CONFIG = {
            apiEndpoint: 'https://4ib0hvu1xj.execute-api.us-east-1.amazonaws.com/prod'
        };
        
        let allGamesData = [];
        let myDeveloperId = '';
        
        async function loadDeveloperInfo() {
            const container = document.getElementById('devInfo');
            
            // Get developer info from storage
            myDeveloperId = localStorage.getItem('developerId') || sessionStorage.getItem('developerId');
            const token = localStorage.getItem('developerToken') || sessionStorage.getItem('developerToken');
            const devInfo = localStorage.getItem('developerInfo') || sessionStorage.getItem('developerInfo');
            
            let html = '<table>';
            html += `<tr><th>Developer ID</th><td>${myDeveloperId || '<span class="error">Not found</span>'}</td></tr>`;
            html += `<tr><th>Token</th><td>${token ? '<span class="success">Found</span>' : '<span class="error">Not found</span>'}</td></tr>`;
            
            if (devInfo) {
                try {
                    const info = JSON.parse(devInfo);
                    html += `<tr><th>Email</th><td>${info.email || 'N/A'}</td></tr>`;
                    html += `<tr><th>Company</th><td>${info.companyName || 'N/A'}</td></tr>`;
                } catch (e) {
                    console.error('Error parsing developer info:', e);
                }
            }
            
            html += '</table>';
            container.innerHTML = html;
        }
        
        async function analyzeGames() {
            const container = document.getElementById('gamesAnalysis');
            container.innerHTML = '<p>Loading games...</p>';
            
            try {
                const response = await fetch(`${AWS_CONFIG.apiEndpoint}/games`);
                const data = await response.json();
                allGamesData = data.games || [];
                
                // Analyze games
                const totalGames = allGamesData.length;
                const gamesWithDevId = allGamesData.filter(g => g.developerId).length;
                const myGames = allGamesData.filter(g => g.developerId === myDeveloperId).length;
                const orphanGames = allGamesData.filter(g => !g.developerId).length;
                
                let html = '<table>';
                html += `<tr><th>Total Games</th><td>${totalGames}</td></tr>`;
                html += `<tr><th>Games with Developer ID</th><td>${gamesWithDevId}</td></tr>`;
                html += `<tr><th>Your Games</th><td class="${myGames > 0 ? 'success' : 'warning'}">${myGames}</td></tr>`;
                html += `<tr><th>Orphan Games (no developer)</th><td class="${orphanGames > 0 ? 'warning' : 'success'}">${orphanGames}</td></tr>`;
                html += '</table>';
                
                // List your games
                if (myGames > 0) {
                    html += '<h3>Your Games:</h3>';
                    const yourGames = allGamesData.filter(g => g.developerId === myDeveloperId);
                    html += '<div style="max-height: 200px; overflow-y: auto;">';
                    yourGames.forEach(game => {
                        html += `<div class="game-item">
                            <span>${game.name || game.title}</span>
                            <span class="success">âœ“ Linked</span>
                        </div>`;
                    });
                    html += '</div>';
                }
                
                container.innerHTML = html;
                
                // Show orphan games
                if (orphanGames > 0) {
                    showOrphanGames(allGamesData.filter(g => !g.developerId));
                }
                
            } catch (error) {
                container.innerHTML = `<p class="error">Error loading games: ${error.message}</p>`;
            }
        }
        
        function showOrphanGames(orphans) {
            const container = document.getElementById('historicalGames');
            let html = '<div style="max-height: 300px; overflow-y: auto;">';
            
            orphans.forEach(game => {
                html += `<div class="game-item">
                    <div>
                        <strong>${game.name || game.title || 'Untitled'}</strong><br>
                        <small>ID: ${game.id || game.gameId}</small>
                    </div>
                    <span class="warning">No Developer</span>
                </div>`;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        async function claimHistoricalGames() {
            const token = localStorage.getItem('developerToken') || sessionStorage.getItem('developerToken');
            if (!token) {
                alert('Please login first to claim games');
                return;
            }
            
            if (!myDeveloperId) {
                alert('No developer ID found');
                return;
            }
            
            const orphans = allGamesData.filter(g => !g.developerId);
            if (orphans.length === 0) {
                alert('No orphan games to claim');
                return;
            }
            
            if (!confirm(`Claim ${orphans.length} games for developer ${myDeveloperId}?`)) {
                return;
            }
            
            alert('This would require backend support to update games. For now, use the quick fix below.');
        }
        
        function generateQuickFix() {
            const fix = `// TEMPORARY FIX: Paste this in browser console on triolldev.com
// This will show ALL games in My Games tab regardless of developerId

window.loadMyGames = async function() {
    const myGamesGrid = document.getElementById('myGamesGrid');
    const developerId = localStorage.getItem('developerId') || sessionStorage.getItem('developerId');
    
    myGamesGrid.innerHTML = '<div style="grid-column: 1/-1; text-align: center;">Loading all games...</div>';
    
    try {
        const response = await fetch('https://4ib0hvu1xj.execute-api.us-east-1.amazonaws.com/prod/games');
        if (response.ok) {
            const result = await response.json();
            const allGames = result.games || [];
            
            // TEMPORARY: Show ALL games, mark which ones are yours
            const gamesWithOwnership = allGames.map(game => ({
                ...game,
                isYours: game.developerId === developerId
            }));
            
            // Sort your games first
            gamesWithOwnership.sort((a, b) => b.isYours - a.isYours);
            
            displayMyGames(gamesWithOwnership);
            console.log('Showing ALL games in My Games tab');
        }
    } catch (error) {
        console.error('Error:', error);
        myGamesGrid.innerHTML = '<div style="grid-column: 1/-1; text-align: center;">Error loading games</div>';
    }
};

// Auto-refresh My Games
if (document.getElementById('myGamesGrid')) {
    loadMyGames();
}`;
            
            document.getElementById('quickFix').textContent = fix;
        }
        
        function copyQuickFix() {
            const fix = document.getElementById('quickFix').textContent;
            navigator.clipboard.writeText(fix).then(() => {
                alert('Fix copied to clipboard! Paste it in the browser console on triolldev.com');
            });
        }
        
        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            loadDeveloperInfo();
            generateQuickFix();
        });
    </script>
</body>
</html>